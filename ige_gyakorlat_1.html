<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÂãïË©û„ÇØ„Ç®„Çπ„Éà ‚Äì Jap√°n Ige Kaland</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&family=Orbitron:wght@700;900&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f0f4ff;
  --bg2: #e4eaff;
  --card: #ffffff;
  --card2: #f7f9ff;
  --border: #c5cef5;
  --accent: #6366f1;
  --accent2: #818cf8;
  --gold: #f59e0b;
  --gold2: #d97706;
  --green: #059669;
  --red: #dc2626;
  --blue: #2563eb;
  --cyan: #0891b2;
  --pink: #db2777;
  --text: #1e1b4b;
  --muted: #6b7280;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Nunito', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}
body::before {
  content: '';
  position: fixed; inset: 0;
  background:
    radial-gradient(ellipse at 20% 10%, rgba(99,102,241,0.12) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 80%, rgba(219,39,119,0.10) 0%, transparent 50%),
    radial-gradient(ellipse at 60% 30%, rgba(245,158,11,0.08) 0%, transparent 40%);
  pointer-events: none; z-index: 0;
}
.screen { display: none; position: relative; z-index: 1; }
.screen.active { display: block; }

/* ‚îÄ‚îÄ WELCOME ‚îÄ‚îÄ */
#welcomeScreen {
  min-height: 100vh;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 2rem 1rem; text-align: center;
}
.logo-kanji {
  font-family: 'Noto Sans JP', sans-serif;
  font-size: clamp(4rem, 12vw, 8rem);
  font-weight: 900; line-height: 1;
  background: linear-gradient(135deg, var(--accent), var(--pink));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  animation: pulse-glow 2s ease-in-out infinite alternate;
  margin-bottom: 0.5rem;
}
@keyframes pulse-glow {
  from { filter: drop-shadow(0 0 15px rgba(99,102,241,0.3)); }
  to   { filter: drop-shadow(0 0 30px rgba(219,39,119,0.5)); }
}
.logo-title {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(1.2rem, 4vw, 2rem); font-weight: 900;
  letter-spacing: 0.1em; color: var(--accent);
  text-shadow: 0 2px 12px rgba(99,102,241,0.25); margin-bottom: 0.5rem;
}
.logo-sub { font-size: 1rem; color: var(--muted); margin-bottom: 2.5rem; }
.section-title {
  font-size: 0.8rem; letter-spacing: 0.12em; color: var(--muted);
  text-transform: uppercase; margin-bottom: 0.75rem; font-weight: 800;
}
.mode-pills { display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; margin-bottom: 2rem; }
.mode-pill {
  background: var(--card); border: 2px solid var(--border);
  border-radius: 50px; padding: 0.4rem 1rem;
  font-size: 0.85rem; font-weight: 700; cursor: pointer;
  transition: all 0.2s; color: var(--muted);
  box-shadow: 0 1px 4px rgba(99,102,241,0.08);
}
.mode-pill.active {
  background: var(--accent); border-color: var(--accent2);
  color: #fff; box-shadow: 0 0 15px rgba(124,58,237,0.4);
}
.difficulty-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
  gap: 1rem; max-width: 620px; width: 100%; margin-bottom: 2rem;
}
.diff-card {
  background: var(--card); border: 2px solid var(--border);
  border-radius: 16px; padding: 1.5rem 1rem;
  cursor: pointer; transition: all 0.25s; position: relative; overflow: hidden;
  box-shadow: 0 2px 12px rgba(99,102,241,0.08);
}
.diff-card::before {
  content: ''; position: absolute; inset: 0; opacity: 0;
  transition: opacity 0.25s; border-radius: 14px;
}
.diff-card.easy::before   { background: linear-gradient(135deg,rgba(16,185,129,.15),transparent); }
.diff-card.normal::before { background: linear-gradient(135deg,rgba(59,130,246,.15),transparent); }
.diff-card.hard::before   { background: linear-gradient(135deg,rgba(239,68,68,.15),transparent); }
.diff-card:hover::before  { opacity: 1; }
.diff-card:hover          { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(99,102,241,0.18); }
.diff-card.easy:hover   { border-color: var(--green); }
.diff-card.normal:hover { border-color: var(--blue); }
.diff-card.hard:hover   { border-color: var(--red); }
.diff-card.selected.easy   { border-color: var(--green); box-shadow: 0 0 20px rgba(16,185,129,0.3); }
.diff-card.selected.normal { border-color: var(--blue);  box-shadow: 0 0 20px rgba(59,130,246,0.3); }
.diff-card.selected.hard   { border-color: var(--red);   box-shadow: 0 0 20px rgba(239,68,68,0.3); }
.diff-icon { font-size: 2.5rem; margin-bottom: 0.5rem; display: block; }
.diff-name { font-size: 1.1rem; font-weight: 800; margin-bottom: 0.3rem; }
.diff-desc { font-size: 0.78rem; color: var(--muted); line-height: 1.4; }
.diff-stars { font-size: 1rem; margin-top: 0.4rem; }
.btn-start {
  background: linear-gradient(135deg, var(--accent), var(--pink));
  color: #fff; border: none; border-radius: 50px;
  padding: 1rem 3rem; font-size: 1.2rem; font-weight: 900;
  font-family: 'Orbitron', sans-serif; letter-spacing: 0.08em;
  cursor: pointer; transition: all 0.2s;
  animation: btn-pulse 2s ease-in-out infinite;
}
@keyframes btn-pulse {
  0%,100% { box-shadow: 0 0 20px rgba(124,58,237,0.4); }
  50%      { box-shadow: 0 0 40px rgba(236,72,153,0.6); }
}
.btn-start:hover { transform: scale(1.05); }

/* ‚îÄ‚îÄ HUD ‚îÄ‚îÄ */
.hud {
  background: rgba(255,255,255,0.92); backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--border);
  padding: 0.65rem 1.25rem;
  display: flex; align-items: center; gap: 0.8rem;
  position: sticky; top: 0; z-index: 100; flex-wrap: wrap;
  box-shadow: 0 2px 12px rgba(99,102,241,0.1);
}
.hud-level { display: flex; align-items: center; gap: 0.5rem; min-width: 0; flex: 1; }
.level-badge {
  background: linear-gradient(135deg, var(--gold), var(--gold2));
  color: #1a1000; font-family: 'Orbitron', sans-serif;
  font-size: 0.68rem; font-weight: 900;
  padding: 0.2rem 0.5rem; border-radius: 6px;
  white-space: nowrap; box-shadow: 0 0 10px rgba(245,158,11,0.4);
  flex-shrink: 0;
}
.xp-bar-wrap { flex: 1; min-width: 60px; }
.xp-label { font-size: 0.62rem; color: var(--muted); display: flex; justify-content: space-between; margin-bottom: 2px; }
.xp-bar-outer { height: 7px; background: var(--bg2); border-radius: 4px; overflow: hidden; border: 1px solid var(--border); }
.xp-bar-inner {
  height: 100%;
  background: linear-gradient(90deg, var(--gold), var(--gold2));
  border-radius: 4px; transition: width 0.5s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow: 0 0 8px rgba(245,158,11,0.5);
}
.hud-stats { display: flex; gap: 0.75rem; align-items: center; }
.hud-stat { display: flex; flex-direction: column; align-items: center; font-size: 0.6rem; color: var(--muted); letter-spacing: 0.05em; text-transform: uppercase; }
.hud-stat-val { font-size: 1rem; font-weight: 800; color: var(--text); line-height: 1.1; }
.streak-pill {
  display: flex; align-items: center; gap: 0.25rem;
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: 20px; padding: 0.25rem 0.6rem;
  font-size: 0.85rem; font-weight: 800; flex-shrink: 0; color: var(--text);
}
.streak-pill.hot {
  border-color: var(--gold); background: rgba(245,158,11,0.15);
  color: var(--gold2); animation: streak-glow 1s ease-in-out infinite alternate;
}
@keyframes streak-glow {
  from { box-shadow: 0 0 5px rgba(245,158,11,0.3); }
  to   { box-shadow: 0 0 15px rgba(245,158,11,0.6); }
}
.timer-ring { position: relative; width: 42px; height: 42px; flex-shrink: 0; }
.timer-ring svg { transform: rotate(-90deg); }
.timer-bg { fill: none; stroke: var(--border); stroke-width: 4; }
.timer-fg { fill: none; stroke: var(--cyan); stroke-width: 4; stroke-linecap: round; stroke-dasharray: 113; stroke-dashoffset: 0; transition: stroke-dashoffset 1s linear, stroke 0.3s; }
.timer-fg.warn { stroke: var(--gold); }
.timer-fg.danger { stroke: var(--red); }
.timer-text { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-family: 'Orbitron', sans-serif; font-size: 0.72rem; font-weight: 700; color: var(--cyan); }
.timer-text.warn { color: var(--gold); }
.timer-text.danger { color: var(--red); animation: blink 0.5s step-end infinite; }
@keyframes blink { 50% { opacity: 0.3; } }

/* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
.quest-progress {
  background: rgba(255,255,255,0.8); padding: 0.4rem 1.25rem;
  display: flex; align-items: center; gap: 0.75rem;
  border-bottom: 1px solid var(--border);
}
.quest-bar-outer { flex: 1; height: 9px; background: var(--bg2); border-radius: 5px; overflow: hidden; border: 1px solid var(--border); }
.quest-bar-inner { height: 100%; background: linear-gradient(90deg, var(--accent), var(--cyan)); border-radius: 5px; transition: width 0.4s ease; box-shadow: 0 0 10px rgba(6,182,212,0.4); }
.quest-label { font-size: 0.72rem; color: var(--muted); white-space: nowrap; font-weight: 700; }

/* ‚îÄ‚îÄ GAME AREA ‚îÄ‚îÄ */
.game-area { max-width: 660px; margin: 0 auto; padding: 1.25rem 1rem 4rem; }
.mode-bar { display: flex; gap: 0.4rem; justify-content: center; margin-bottom: 1.25rem; flex-wrap: wrap; }
.mode-chip {
  background: var(--card); border: 1.5px solid var(--border);
  border-radius: 20px; padding: 0.25rem 0.8rem;
  font-size: 0.78rem; font-weight: 700; cursor: pointer;
  transition: all 0.2s; color: var(--muted);
  box-shadow: 0 1px 4px rgba(99,102,241,0.08);
}
.mode-chip.active { background: var(--accent); border-color: var(--accent2); color: #fff; box-shadow: 0 0 10px rgba(124,58,237,0.3); }

.question-card {
  background: var(--card);
  border: 2px solid var(--border); border-radius: 20px;
  padding: 1.75rem; position: relative;
  box-shadow: 0 4px 24px rgba(99,102,241,0.12);
  animation: card-in 0.35s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes card-in {
  from { opacity:0; transform: translateY(18px) scale(0.96); }
  to   { opacity:1; transform: translateY(0) scale(1); }
}
.q-number {
  position: absolute; top: -12px; left: 1.5rem;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: #fff; font-family: 'Orbitron', sans-serif;
  font-size: 0.68rem; font-weight: 700;
  padding: 0.18rem 0.8rem; border-radius: 20px;
  box-shadow: 0 0 12px rgba(124,58,237,0.4);
}
.verb-display { text-align: center; margin-bottom: 1.25rem; }
.verb-kanji {
  font-family: 'Noto Sans JP', sans-serif;
  font-size: clamp(2.8rem, 9vw, 4.5rem); font-weight: 900; line-height: 1.1;
  background: linear-gradient(135deg, var(--accent), var(--pink));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.verb-meta { display: flex; gap: 0.5rem; justify-content: center; margin-top: 0.4rem; flex-wrap: wrap; }
.tag { font-size: 0.72rem; font-weight: 700; padding: 0.18rem 0.65rem; border-radius: 20px; border: 1px solid; }
.tag-group   { border-color: var(--cyan); color: var(--cyan); background: rgba(8,145,178,0.08); }
.tag-meaning { border-color: var(--muted); color: var(--muted); background: rgba(107,114,128,0.08); }

.question-box {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: 12px; padding: 0.85rem 1.1rem; margin-bottom: 1.1rem;
  font-size: 0.97rem; font-weight: 700; line-height: 1.5; color: var(--text);
}
.type-badge {
  display: inline-block;
  background: linear-gradient(135deg, var(--accent), var(--pink));
  color: #fff; font-size: 0.7rem; font-weight: 800;
  padding: 0.12rem 0.55rem; border-radius: 10px; margin-bottom: 0.35rem;
}
.answer-area { display: flex; gap: 0.65rem; align-items: stretch; margin-bottom: 0.75rem; }
.answer-input {
  flex: 1; font-size: 1.3rem; font-family: 'Noto Sans JP', sans-serif;
  background: var(--card2); border: 2px solid var(--border);
  border-radius: 12px; padding: 0.6rem 0.9rem; color: var(--text);
  outline: none; transition: all 0.2s; min-width: 0;
}
.answer-input:focus { border-color: var(--accent); background: #fff; box-shadow: 0 0 0 3px rgba(99,102,241,0.15); }
.answer-input.correct { border-color: var(--green); background: #f0fdf4; box-shadow: 0 0 0 3px rgba(5,150,105,0.15); }
.answer-input.wrong   { border-color: var(--red);   background: #fff5f5; box-shadow: 0 0 0 3px rgba(220,38,38,0.15); }
.btn-check {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: #fff; border: none; border-radius: 12px;
  padding: 0.6rem 1.25rem; font-size: 0.88rem; font-weight: 800;
  font-family: 'Nunito', sans-serif; cursor: pointer; transition: all 0.2s;
  white-space: nowrap; box-shadow: 0 4px 15px rgba(124,58,237,0.3);
}
.btn-check:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(124,58,237,0.5); }
.btn-check:disabled { opacity: 0.5; cursor: default; }
.hint-row {
  display: flex; align-items: center; gap: 0.5rem;
  font-size: 0.8rem; color: var(--muted);
  cursor: pointer; user-select: none; margin-bottom: 0.4rem;
}
.hint-row input { accent-color: var(--accent2); }
.hint-text { color: var(--gold2); font-style: italic; font-weight: 700; }
.hint-cost { color: var(--red); font-size: 0.72rem; }
.feedback-area {
  min-height: 2.2rem; display: flex; align-items: center; gap: 0.6rem;
  font-size: 0.95rem; font-weight: 800; border-radius: 8px; padding: 0.3rem 0;
}
.feedback-area.correct { color: var(--green); }
.feedback-area.wrong   { color: var(--red); }
.nav-row { display: flex; gap: 0.65rem; justify-content: flex-end; margin-top: 0.9rem; }
.btn-skip {
  background: var(--card2); border: 2px solid var(--border); border-radius: 10px;
  color: var(--muted); padding: 0.45rem 0.9rem; font-size: 0.82rem; font-weight: 700;
  font-family: 'Nunito', sans-serif; cursor: pointer; transition: all 0.2s;
}
.btn-skip:hover { border-color: var(--muted); color: var(--text); background: var(--bg2); }
.btn-next {
  background: linear-gradient(135deg, var(--green), #059669);
  color: #fff; border: none; border-radius: 10px;
  padding: 0.45rem 1.4rem; font-size: 0.88rem; font-weight: 800;
  font-family: 'Nunito', sans-serif; cursor: pointer; transition: all 0.2s;
  box-shadow: 0 4px 15px rgba(16,185,129,0.3); display: none;
}
.btn-next:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(16,185,129,0.5); }

/* ‚îÄ‚îÄ XP POPUP ‚îÄ‚îÄ */
.xp-popup {
  position: fixed; font-family: 'Orbitron', sans-serif;
  font-size: 1.3rem; font-weight: 900; color: var(--gold2);
  text-shadow: 0 0 20px rgba(251,191,36,0.8);
  pointer-events: none; z-index: 999;
  animation: xp-fly 1.2s ease-out forwards;
}
@keyframes xp-fly {
  0%   { opacity: 1; transform: translateY(0) scale(1); }
  100% { opacity: 0; transform: translateY(-80px) scale(1.4); }
}

/* ‚îÄ‚îÄ ACHIEVEMENT TOAST ‚îÄ‚îÄ */
.achievement-toast {
  position: fixed; top: 80px; right: 1rem;
  background: var(--card);
  border: 2px solid var(--gold); border-radius: 16px;
  padding: 0.9rem 1.1rem;
  display: flex; align-items: center; gap: 0.85rem;
  z-index: 500; box-shadow: 0 8px 30px rgba(245,158,11,0.25);
  animation: toast-in 0.4s cubic-bezier(0.34,1.56,0.64,1);
  max-width: 300px;
}
@keyframes toast-in {
  from { opacity:0; transform: translateX(120%) scale(0.8); }
  to   { opacity:1; transform: translateX(0) scale(1); }
}
.toast-icon { font-size: 1.8rem; flex-shrink: 0; }
.toast-title { font-size: 0.65rem; color: var(--gold2); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 800; }
.toast-name  { font-size: 0.95rem; font-weight: 900; color: var(--text); }
.toast-desc  { font-size: 0.75rem; color: var(--muted); }
/* ‚îÄ‚îÄ RESULT ‚îÄ‚îÄ */
#resultScreen {
  min-height: 100vh; padding: 2rem 1rem;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
}
.result-container { max-width: 580px; width: 100%; }
.grade-display { text-align: center; margin-bottom: 1.75rem; }
.grade-letter {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(5rem, 18vw, 9rem); font-weight: 900; line-height: 1;
  animation: grade-pop 0.6s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes grade-pop {
  from { transform: scale(0) rotate(-20deg); opacity: 0; }
  to   { transform: scale(1) rotate(0); opacity: 1; }
}
.grade-A { background: linear-gradient(135deg,var(--gold),#fff,var(--gold2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; filter:drop-shadow(0 0 30px rgba(245,158,11,0.8)); }
.grade-B { background: linear-gradient(135deg,var(--green),#a7f3d0); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; filter:drop-shadow(0 0 20px rgba(16,185,129,0.6)); }
.grade-C { background: linear-gradient(135deg,var(--blue),#93c5fd); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; filter:drop-shadow(0 0 20px rgba(59,130,246,0.6)); }
.grade-D { background: linear-gradient(135deg,var(--gold),#fde68a); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
.grade-F { background: linear-gradient(135deg,var(--red),#fca5a5); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
.grade-title { font-size: 1.4rem; font-weight: 900; margin-bottom: 0.2rem; }
.grade-msg   { color: var(--muted); font-size: 0.92rem; }

.pass-banner {
  border-radius: 14px; padding: 1.1rem; text-align: center;
  margin-bottom: 1.25rem; font-size: 1rem; font-weight: 800; border: 2px solid;
}
.pass-banner.passed { background: rgba(16,185,129,0.1); border-color: var(--green); color: var(--green); }
.pass-banner.failed { background: rgba(239,68,68,0.1);  border-color: var(--red);   color: var(--red); }

.result-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 0.75rem; margin-bottom: 1.25rem; }
.result-cell {
  background: var(--card); border: 1.5px solid var(--border);
  border-radius: 14px; padding: 1rem 0.5rem; text-align: center;
  box-shadow: 0 2px 8px rgba(99,102,241,0.08);
}
.result-cell-icon { font-size: 1.3rem; margin-bottom: 0.25rem; display: block; }
.result-cell-val { font-family: 'Orbitron', sans-serif; font-size: 1.6rem; font-weight: 700; line-height: 1; margin-bottom: 0.2rem; }
.result-cell-lbl { font-size: 0.68rem; color: var(--muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.07em; }

.ach-section {
  background: var(--card); border: 1.5px solid var(--border);
  border-radius: 14px; padding: 0.9rem 1rem; margin-bottom: 1.25rem;
  box-shadow: 0 2px 8px rgba(99,102,241,0.08);
}
.ach-section h3 { font-size: 0.75rem; color: var(--gold2); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.6rem; font-weight: 800; }
.ach-list { display: flex; flex-wrap: wrap; gap: 0.4rem; }
.ach-badge {
  background: rgba(245,158,11,0.1); border: 1px solid var(--gold);
  border-radius: 20px; padding: 0.25rem 0.7rem;
  font-size: 0.78rem; font-weight: 700; color: var(--gold2);
  display: flex; align-items: center; gap: 0.3rem;
}
.result-buttons { display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center; }
.btn-menu {
  background: var(--card2); border: 2px solid var(--border); border-radius: 50px;
  color: var(--muted); padding: 0.8rem 1.75rem;
  font-size: 0.95rem; font-weight: 700;
  font-family: 'Nunito', sans-serif; cursor: pointer; transition: all 0.2s;
}
.btn-menu:hover { border-color: var(--accent); color: var(--text); background: var(--bg2); }
.btn-restart {
  background: linear-gradient(135deg, var(--accent), var(--pink));
  color: #fff; border: none; border-radius: 50px;
  padding: 0.8rem 2.25rem; font-size: 1rem; font-weight: 900;
  font-family: 'Orbitron', sans-serif; cursor: pointer;
  box-shadow: 0 0 20px rgba(124,58,237,0.4); transition: all 0.2s;
  letter-spacing: 0.06em;
}
.btn-restart:hover { transform: scale(1.05); }

/* ‚îÄ‚îÄ FX ‚îÄ‚îÄ */
.confetti-piece {
  position: fixed; pointer-events: none; z-index: 1000;
  animation: confetti-fall linear forwards;
}
@keyframes confetti-fall {
  0%   { transform: translateY(-20px) rotate(0deg); opacity:1; }
  100% { transform: translateY(110vh) rotate(720deg); opacity:0; }
}
@keyframes shake {
  0%,100%{transform:translateX(0)} 20%{transform:translateX(-8px)}
  40%{transform:translateX(8px)} 60%{transform:translateX(-5px)} 80%{transform:translateX(5px)}
}
.shake { animation: shake 0.4s ease; }
.flash-el {
  position: fixed; inset: 0; pointer-events: none; z-index: 200;
  animation: flash-out 0.35s ease forwards;
}
@keyframes flash-out { 0%{opacity:1} 100%{opacity:0} }
</style>
</head>
<body>

<div style="position: fixed; top: 10px; left: 10px; z-index: 9999;">
  <a href="index.html" style="
    display: inline-flex;
    align-items: center;
    gap: 6px;
    text-decoration: none;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-family: sans-serif;
    backdrop-filter: blur(4px);
  ">‚Üê „Éà„ÉÉ„Éó„Å∏</a>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WELCOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="welcomeScreen" class="screen active">
  <div class="logo-kanji">Âãï</div>
  <div class="logo-title">D≈åSHI QUEST</div>
  <div class="logo-sub">Jap√°n igeragoz√°s kaland ‚Äì Futs≈´kei (ÊôÆÈÄöÂΩ¢)</div>

  <div class="section-title">V√°laszd ki a gyakorland√≥ alakot</div>
  <div class="mode-pills">
    <div class="mode-pill active" data-mode="all" onclick="selectMode(this)">üóÇ √ñsszes alak</div>
    <div class="mode-pill" data-mode="present-pos" onclick="selectMode(this)">‚úÖ Jelen √°ll√≠t√≥</div>
    <div class="mode-pill" data-mode="present-neg" onclick="selectMode(this)">‚ùå Jelen tagad√≥</div>
    <div class="mode-pill" data-mode="past-pos" onclick="selectMode(this)">‚úÖ M√∫lt √°ll√≠t√≥</div>
    <div class="mode-pill" data-mode="past-neg" onclick="selectMode(this)">‚ùå M√∫lt tagad√≥</div>
  </div>

  <div class="section-title">V√°lassz neh√©zs√©gi fokot</div>
  <div class="difficulty-grid">
    <div class="diff-card easy" onclick="selectDiff('easy',this)">
      <span class="diff-icon">üå∏</span>
      <div class="diff-name" style="color:var(--green)">K√∂nny≈±</div>
      <div class="diff-desc">Nincs id≈ëkorl√°t ¬∑ Seg√≠ts√©g ingyenes ¬∑ Kisebb b√ºntet√©s</div>
      <div class="diff-stars">‚≠ê</div>
    </div>
    <div class="diff-card normal selected" onclick="selectDiff('normal',this)">
      <span class="diff-icon">‚öîÔ∏è</span>
      <div class="diff-name" style="color:var(--blue)">Norm√°l</div>
      <div class="diff-desc">20 mp / k√©rd√©s ¬∑ Seg√≠ts√©g: ‚Äì5 XP ¬∑ K√∂zepes b√ºntet√©s</div>
      <div class="diff-stars">‚≠ê‚≠ê</div>
    </div>
    <div class="diff-card hard" onclick="selectDiff('hard',this)">
      <span class="diff-icon">üî•</span>
      <div class="diff-name" style="color:var(--red)">Neh√©z</div>
      <div class="diff-desc">10 mp / k√©rd√©s ¬∑ Nincs seg√≠ts√©g ¬∑ Dupla XP jutalom</div>
      <div class="diff-stars">‚≠ê‚≠ê‚≠ê</div>
    </div>
  </div>

  <button class="btn-start" onclick="startGame()">‚ö° J√ÅT√âK IND√çT√ÅSA</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GAME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="gameScreen" class="screen">
  <div class="hud">
    <div class="hud-level">
      <div class="level-badge" id="levelBadge">LVL 1</div>
      <div class="xp-bar-wrap">
        <div class="xp-label"><span>XP</span><span id="xpLabel">0 / 100</span></div>
        <div class="xp-bar-outer"><div class="xp-bar-inner" id="xpBar" style="width:0%"></div></div>
      </div>
    </div>
    <div class="hud-stats">
      <div class="hud-stat"><span class="hud-stat-val" id="hudC" style="color:var(--green)">0</span><span>Helyes</span></div>
      <div class="hud-stat"><span class="hud-stat-val" id="hudW" style="color:var(--red)">0</span><span>Hib√°s</span></div>
    </div>
    <div class="streak-pill" id="streakPill">üî• <span id="streakNum">0</span></div>
    <div class="timer-ring">
      <svg width="42" height="42" viewBox="0 0 42 42">
        <circle class="timer-bg" cx="21" cy="21" r="17"/>
        <circle class="timer-fg" id="timerArc" cx="21" cy="21" r="17"/>
      </svg>
      <div class="timer-text" id="timerTxt">‚àû</div>
    </div>
  </div>

  <div class="quest-progress">
    <div class="quest-bar-outer"><div class="quest-bar-inner" id="questBar" style="width:0%"></div></div>
    <div class="quest-label" id="questLbl">0 / 0</div>
  </div>

  <div class="game-area">
    <div class="mode-bar" id="gameModeBar">
      <div class="mode-chip active" data-mode="all" onclick="changeMode(this)">√ñsszes</div>
      <div class="mode-chip" data-mode="present-pos" onclick="changeMode(this)">Jelen ‚úì</div>
      <div class="mode-chip" data-mode="present-neg" onclick="changeMode(this)">Jelen ‚úó</div>
      <div class="mode-chip" data-mode="past-pos" onclick="changeMode(this)">M√∫lt ‚úì</div>
      <div class="mode-chip" data-mode="past-neg" onclick="changeMode(this)">M√∫lt ‚úó</div>
    </div>

    <div class="question-card" id="questionCard">
      <div class="q-number" id="qNum">Q 1</div>
      <div class="verb-display">
        <div class="verb-kanji" id="verbKanji">‚Äî</div>
        <div class="verb-meta">
          <span class="tag tag-group"   id="verbGroup">‚Äî</span>
          <span class="tag tag-meaning" id="verbMeaning">‚Äî</span>
        </div>
      </div>
      <div class="question-box">
        <div class="type-badge" id="typeBadge">‚Äî</div><br>
        <span id="qText">‚Ä¶</span>
      </div>
      <div class="answer-area">
        <input type="text" class="answer-input" id="ansInput"
               placeholder="Êº¢Â≠ó„Åæ„Åü„ÅØ„Å≤„Çâ„Åå„Å™„ÅßÂÖ•Âäõ‚Ä¶" autocomplete="off" autocorrect="off"
               onkeydown="onKey(event)">
        <button class="btn-check" id="checkBtn" onclick="checkAnswer()">Ellen≈ërz√©s</button>
      </div>
      <label class="hint-row" id="hintRow">
        <input type="checkbox" id="hintToggle" onchange="toggleHint()">
        Seg√≠ts√©g k√©r√©se
        <span class="hint-cost" id="hintCost"></span>
        <span class="hint-text" id="hintTxt"></span>
      </label>
      <div class="feedback-area" id="feedback"></div>
      <div class="nav-row">
        <button class="btn-skip" onclick="skipQ()">‚è≠ Kihagy√°s</button>
        <button class="btn-next" id="nextBtn" onclick="nextQ()">K√∂vetkez≈ë ‚ûú</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESULT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="resultScreen" class="screen">
  <div class="result-container">
    <div class="grade-display">
      <div class="grade-letter" id="gradeLetter">A</div>
      <div class="grade-title" id="gradeTitle">Kiv√°l√≥!</div>
      <div class="grade-msg"   id="gradeMsg">‚Äî</div>
    </div>

    <div class="pass-banner" id="passBanner">‚Äî</div>

    <div class="result-grid">
      <div class="result-cell">
        <span class="result-cell-icon">‚úÖ</span>
        <div class="result-cell-val" id="rC" style="color:var(--green)">0</div>
        <div class="result-cell-lbl">Helyes</div>
      </div>
      <div class="result-cell">
        <span class="result-cell-icon">‚ùå</span>
        <div class="result-cell-val" id="rW" style="color:var(--red)">0</div>
        <div class="result-cell-lbl">Hib√°s</div>
      </div>
      <div class="result-cell">
        <span class="result-cell-icon">üìä</span>
        <div class="result-cell-val" id="rPct" style="color:var(--cyan)">0%</div>
        <div class="result-cell-lbl">Pontoss√°g</div>
      </div>
      <div class="result-cell">
        <span class="result-cell-icon">‚ö°</span>
        <div class="result-cell-val" id="rXP" style="color:var(--gold2)">0</div>
        <div class="result-cell-lbl">Szerzett XP</div>
      </div>
      <div class="result-cell">
        <span class="result-cell-icon">üî•</span>
        <div class="result-cell-val" id="rStreak" style="color:var(--pink)">0</div>
        <div class="result-cell-lbl">Max sorozat</div>
      </div>
      <div class="result-cell">
        <span class="result-cell-icon">‚è±Ô∏è</span>
        <div class="result-cell-val" id="rTime" style="color:var(--accent2)">‚Äî</div>
        <div class="result-cell-lbl">√Åtlag id≈ë</div>
      </div>
    </div>

    <div class="ach-section" id="achSection" style="display:none">
      <h3>üèÜ Feloldott eredm√©nyek</h3>
      <div class="ach-list" id="achList"></div>
    </div>

    <div class="result-buttons">
      <button class="btn-menu" onclick="goMenu()">‚Üê Men√º</button>
      <button class="btn-restart" onclick="restartSame()">üîÑ √öJRA</button>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê
const verbs = [
  {dict:"Ë≤∑„ÅÜ",    group:"‚Ö†", present_pos:"Ë≤∑„ÅÜ",    present_neg:"Ë≤∑„Çè„Å™„ÅÑ",   past_pos:"Ë≤∑„Å£„Åü",    past_neg:"Ë≤∑„Çè„Å™„Åã„Å£„Åü",   meaning:"venni",
   h_present_pos:"„Åã„ÅÜ",      h_present_neg:"„Åã„Çè„Å™„ÅÑ",    h_past_pos:"„Åã„Å£„Åü",     h_past_neg:"„Åã„Çè„Å™„Åã„Å£„Åü"},
  {dict:"Ë°å„Åè",    group:"‚Ö†", present_pos:"Ë°å„Åè",    present_neg:"Ë°å„Åã„Å™„ÅÑ",   past_pos:"Ë°å„Å£„Åü",    past_neg:"Ë°å„Åã„Å™„Åã„Å£„Åü",   meaning:"menni",
   h_present_pos:"„ÅÑ„Åè",      h_present_neg:"„ÅÑ„Åã„Å™„ÅÑ",    h_past_pos:"„ÅÑ„Å£„Åü",     h_past_neg:"„ÅÑ„Åã„Å™„Åã„Å£„Åü"},
  {dict:"Ë©±„Åô",    group:"‚Ö†", present_pos:"Ë©±„Åô",    present_neg:"Ë©±„Åï„Å™„ÅÑ",   past_pos:"Ë©±„Åó„Åü",    past_neg:"Ë©±„Åï„Å™„Åã„Å£„Åü",   meaning:"besz√©lni",
   h_present_pos:"„ÅØ„Å™„Åô",    h_present_neg:"„ÅØ„Å™„Åï„Å™„ÅÑ",  h_past_pos:"„ÅØ„Å™„Åó„Åü",   h_past_neg:"„ÅØ„Å™„Åï„Å™„Åã„Å£„Åü"},
  {dict:"ÂæÖ„Å§",    group:"‚Ö†", present_pos:"ÂæÖ„Å§",    present_neg:"ÂæÖ„Åü„Å™„ÅÑ",   past_pos:"ÂæÖ„Å£„Åü",    past_neg:"ÂæÖ„Åü„Å™„Åã„Å£„Åü",   meaning:"v√°rni",
   h_present_pos:"„Åæ„Å§",      h_present_neg:"„Åæ„Åü„Å™„ÅÑ",    h_past_pos:"„Åæ„Å£„Åü",     h_past_neg:"„Åæ„Åü„Å™„Åã„Å£„Åü"},
  {dict:"Ê≠ª„Å¨",    group:"‚Ö†", present_pos:"Ê≠ª„Å¨",    present_neg:"Ê≠ª„Å™„Å™„ÅÑ",   past_pos:"Ê≠ª„Çì„Å†",    past_neg:"Ê≠ª„Å™„Å™„Åã„Å£„Åü",   meaning:"meghalni",
   h_present_pos:"„Åó„Å¨",      h_present_neg:"„Åó„Å™„Å™„ÅÑ",    h_past_pos:"„Åó„Çì„Å†",     h_past_neg:"„Åó„Å™„Å™„Åã„Å£„Åü"},
  {dict:"È£≤„ÇÄ",    group:"‚Ö†", present_pos:"È£≤„ÇÄ",    present_neg:"È£≤„Åæ„Å™„ÅÑ",   past_pos:"È£≤„Çì„Å†",    past_neg:"È£≤„Åæ„Å™„Åã„Å£„Åü",   meaning:"inni",
   h_present_pos:"„ÅÆ„ÇÄ",      h_present_neg:"„ÅÆ„Åæ„Å™„ÅÑ",    h_past_pos:"„ÅÆ„Çì„Å†",     h_past_neg:"„ÅÆ„Åæ„Å™„Åã„Å£„Åü"},
  {dict:"Â∏∞„Çã",    group:"‚Ö†", present_pos:"Â∏∞„Çã",    present_neg:"Â∏∞„Çâ„Å™„ÅÑ",   past_pos:"Â∏∞„Å£„Åü",    past_neg:"Â∏∞„Çâ„Å™„Åã„Å£„Åü",   meaning:"hazamenni",
   h_present_pos:"„Åã„Åà„Çã",    h_present_neg:"„Åã„Åà„Çâ„Å™„ÅÑ",  h_past_pos:"„Åã„Åà„Å£„Åü",   h_past_neg:"„Åã„Åà„Çâ„Å™„Åã„Å£„Åü"},
  {dict:"Êõ∏„Åè",    group:"‚Ö†", present_pos:"Êõ∏„Åè",    present_neg:"Êõ∏„Åã„Å™„ÅÑ",   past_pos:"Êõ∏„ÅÑ„Åü",    past_neg:"Êõ∏„Åã„Å™„Åã„Å£„Åü",   meaning:"√≠rni",
   h_present_pos:"„Åã„Åè",      h_present_neg:"„Åã„Åã„Å™„ÅÑ",    h_past_pos:"„Åã„ÅÑ„Åü",     h_past_neg:"„Åã„Åã„Å™„Åã„Å£„Åü"},
  {dict:"ËÅû„Åè",    group:"‚Ö†", present_pos:"ËÅû„Åè",    present_neg:"ËÅû„Åã„Å™„ÅÑ",   past_pos:"ËÅû„ÅÑ„Åü",    past_neg:"ËÅû„Åã„Å™„Åã„Å£„Åü",   meaning:"hallgatni",
   h_present_pos:"„Åç„Åè",      h_present_neg:"„Åç„Åã„Å™„ÅÑ",    h_past_pos:"„Åç„ÅÑ„Åü",     h_past_neg:"„Åç„Åã„Å™„Åã„Å£„Åü"},
  {dict:"Ê≥≥„Åê",    group:"‚Ö†", present_pos:"Ê≥≥„Åê",    present_neg:"Ê≥≥„Åå„Å™„ÅÑ",   past_pos:"Ê≥≥„ÅÑ„Å†",    past_neg:"Ê≥≥„Åå„Å™„Åã„Å£„Åü",   meaning:"√∫szni",
   h_present_pos:"„Åä„Çà„Åê",    h_present_neg:"„Åä„Çà„Åå„Å™„ÅÑ",  h_past_pos:"„Åä„Çà„ÅÑ„Å†",   h_past_neg:"„Åä„Çà„Åå„Å™„Åã„Å£„Åü"},
  {dict:"ÊÄ•„Åê",    group:"‚Ö†", present_pos:"ÊÄ•„Åê",    present_neg:"ÊÄ•„Åå„Å™„ÅÑ",   past_pos:"ÊÄ•„ÅÑ„Å†",    past_neg:"ÊÄ•„Åå„Å™„Åã„Å£„Åü",   meaning:"sietni",
   h_present_pos:"„ÅÑ„Åù„Åê",    h_present_neg:"„ÅÑ„Åù„Åå„Å™„ÅÑ",  h_past_pos:"„ÅÑ„Åù„ÅÑ„Å†",   h_past_neg:"„ÅÑ„Åù„Åå„Å™„Åã„Å£„Åü"},
  {dict:"Ë™≠„ÇÄ",    group:"‚Ö†", present_pos:"Ë™≠„ÇÄ",    present_neg:"Ë™≠„Åæ„Å™„ÅÑ",   past_pos:"Ë™≠„Çì„Å†",    past_neg:"Ë™≠„Åæ„Å™„Åã„Å£„Åü",   meaning:"olvasni",
   h_present_pos:"„Çà„ÇÄ",      h_present_neg:"„Çà„Åæ„Å™„ÅÑ",    h_past_pos:"„Çà„Çì„Å†",     h_past_neg:"„Çà„Åæ„Å™„Åã„Å£„Åü"},
  {dict:"ÈÅä„Å∂",    group:"‚Ö†", present_pos:"ÈÅä„Å∂",    present_neg:"ÈÅä„Å∞„Å™„ÅÑ",   past_pos:"ÈÅä„Çì„Å†",    past_neg:"ÈÅä„Å∞„Å™„Åã„Å£„Åü",   meaning:"j√°tszani",
   h_present_pos:"„ÅÇ„Åù„Å∂",    h_present_neg:"„ÅÇ„Åù„Å∞„Å™„ÅÑ",  h_past_pos:"„ÅÇ„Åù„Çì„Å†",   h_past_neg:"„ÅÇ„Åù„Å∞„Å™„Åã„Å£„Åü"},
  {dict:"„Çè„Åã„Çã",  group:"‚Ö†", present_pos:"„Çè„Åã„Çã",  present_neg:"„Çè„Åã„Çâ„Å™„ÅÑ", past_pos:"„Çè„Åã„Å£„Åü",  past_neg:"„Çè„Åã„Çâ„Å™„Åã„Å£„Åü", meaning:"√©rteni",
   h_present_pos:"„Çè„Åã„Çã",    h_present_neg:"„Çè„Åã„Çâ„Å™„ÅÑ",  h_past_pos:"„Çè„Åã„Å£„Åü",   h_past_neg:"„Çè„Åã„Çâ„Å™„Åã„Å£„Åü"},
  {dict:"„ÅÇ„Çã",    group:"‚Ö†", present_pos:"„ÅÇ„Çã",    present_neg:"„Å™„ÅÑ",       past_pos:"„ÅÇ„Å£„Åü",    past_neg:"„Å™„Åã„Å£„Åü",       meaning:"l√©tezni (t√°rgy)",
   h_present_pos:"„ÅÇ„Çã",      h_present_neg:"„Å™„ÅÑ",        h_past_pos:"„ÅÇ„Å£„Åü",     h_past_neg:"„Å™„Åã„Å£„Åü"},
  {dict:"Ëµ∑„Åç„Çã",  group:"‚Ö°", present_pos:"Ëµ∑„Åç„Çã",  present_neg:"Ëµ∑„Åç„Å™„ÅÑ",   past_pos:"Ëµ∑„Åç„Åü",    past_neg:"Ëµ∑„Åç„Å™„Åã„Å£„Åü",   meaning:"felkelni",
   h_present_pos:"„Åä„Åç„Çã",    h_present_neg:"„Åä„Åç„Å™„ÅÑ",    h_past_pos:"„Åä„Åç„Åü",     h_past_neg:"„Åä„Åç„Å™„Åã„Å£„Åü"},
  {dict:"È£ü„Åπ„Çã",  group:"‚Ö°", present_pos:"È£ü„Åπ„Çã",  present_neg:"È£ü„Åπ„Å™„ÅÑ",   past_pos:"È£ü„Åπ„Åü",    past_neg:"È£ü„Åπ„Å™„Åã„Å£„Åü",   meaning:"enni",
   h_present_pos:"„Åü„Åπ„Çã",    h_present_neg:"„Åü„Åπ„Å™„ÅÑ",    h_past_pos:"„Åü„Åπ„Åü",     h_past_neg:"„Åü„Åπ„Å™„Åã„Å£„Åü"},
  {dict:"Ë¶ã„Çã",    group:"‚Ö°", present_pos:"Ë¶ã„Çã",    present_neg:"Ë¶ã„Å™„ÅÑ",     past_pos:"Ë¶ã„Åü",      past_neg:"Ë¶ã„Å™„Åã„Å£„Åü",     meaning:"n√©zni",
   h_present_pos:"„Åø„Çã",      h_present_neg:"„Åø„Å™„ÅÑ",      h_past_pos:"„Åø„Åü",       h_past_neg:"„Åø„Å™„Åã„Å£„Åü"},
  {dict:"ÁùÄ„Çã",    group:"‚Ö°", present_pos:"ÁùÄ„Çã",    present_neg:"ÁùÄ„Å™„ÅÑ",     past_pos:"ÁùÄ„Åü",      past_neg:"ÁùÄ„Å™„Åã„Å£„Åü",     meaning:"felvenni (fels≈ët)",
   h_present_pos:"„Åç„Çã",      h_present_neg:"„Åç„Å™„ÅÑ",      h_past_pos:"„Åç„Åü",       h_past_neg:"„Åç„Å™„Åã„Å£„Åü"},
  {dict:"„ÅÑ„Çã",    group:"‚Ö°", present_pos:"„ÅÑ„Çã",    present_neg:"„ÅÑ„Å™„ÅÑ",     past_pos:"„ÅÑ„Åü",      past_neg:"„ÅÑ„Å™„Åã„Å£„Åü",     meaning:"l√©tezni (√©l≈ël√©ny)",
   h_present_pos:"„ÅÑ„Çã",      h_present_neg:"„ÅÑ„Å™„ÅÑ",      h_past_pos:"„ÅÑ„Åü",       h_past_neg:"„ÅÑ„Å™„Åã„Å£„Åü"},
  {dict:"ÂØù„Çã",    group:"‚Ö°", present_pos:"ÂØù„Çã",    present_neg:"ÂØù„Å™„ÅÑ",     past_pos:"ÂØù„Åü",      past_neg:"ÂØù„Å™„Åã„Å£„Åü",     meaning:"aludni",
   h_present_pos:"„Å≠„Çã",      h_present_neg:"„Å≠„Å™„ÅÑ",      h_past_pos:"„Å≠„Åü",       h_past_neg:"„Å≠„Å™„Åã„Å£„Åü"},
  {dict:"Âá∫„Åã„Åë„Çã",group:"‚Ö°", present_pos:"Âá∫„Åã„Åë„Çã",present_neg:"Âá∫„Åã„Åë„Å™„ÅÑ", past_pos:"Âá∫„Åã„Åë„Åü",  past_neg:"Âá∫„Åã„Åë„Å™„Åã„Å£„Åü", meaning:"elmenni hazulr√≥l",
   h_present_pos:"„Åß„Åã„Åë„Çã",  h_present_neg:"„Åß„Åã„Åë„Å™„ÅÑ",  h_past_pos:"„Åß„Åã„Åë„Åü",   h_past_neg:"„Åß„Åã„Åë„Å™„Åã„Å£„Åü"},
  {dict:"Êù•„Çã",    group:"‚Ö¢", present_pos:"Êù•„Çã",    present_neg:"Êù•„Å™„ÅÑ",     past_pos:"Êù•„Åü",      past_neg:"Êù•„Å™„Åã„Å£„Åü",     meaning:"j√∂nni",
   h_present_pos:"„Åè„Çã",      h_present_neg:"„Åì„Å™„ÅÑ",      h_past_pos:"„Åç„Åü",       h_past_neg:"„Åì„Å™„Åã„Å£„Åü"},
  {dict:"„Åô„Çã",    group:"‚Ö¢", present_pos:"„Åô„Çã",    present_neg:"„Åó„Å™„ÅÑ",     past_pos:"„Åó„Åü",      past_neg:"„Åó„Å™„Åã„Å£„Åü",     meaning:"csin√°lni",
   h_present_pos:"„Åô„Çã",      h_present_neg:"„Åó„Å™„ÅÑ",      h_past_pos:"„Åó„Åü",       h_past_neg:"„Åó„Å™„Åã„Å£„Åü"},
  {dict:"ÂãâÂº∑„Åô„Çã",group:"‚Ö¢", present_pos:"ÂãâÂº∑„Åô„Çã",present_neg:"ÂãâÂº∑„Åó„Å™„ÅÑ", past_pos:"ÂãâÂº∑„Åó„Åü",  past_neg:"ÂãâÂº∑„Åó„Å™„Åã„Å£„Åü", meaning:"tanulni",
   h_present_pos:"„Åπ„Çì„Åç„Çá„ÅÜ„Åô„Çã", h_present_neg:"„Åπ„Çì„Åç„Çá„ÅÜ„Åó„Å™„ÅÑ", h_past_pos:"„Åπ„Çì„Åç„Çá„ÅÜ„Åó„Åü", h_past_neg:"„Åπ„Çì„Åç„Çá„ÅÜ„Åó„Å™„Åã„Å£„Åü"},
];

const QT = {
  'present-pos':{key:'present_pos', badge:'‚úÖ Jelen ¬∑ √Åll√≠t√≥', label:'jelen id≈ë √°ll√≠t√≥ alakja'},
  'present-neg':{key:'present_neg', badge:'‚ùå Jelen ¬∑ Tagad√≥', label:'jelen id≈ë tagad√≥ alakja'},
  'past-pos':   {key:'past_pos',    badge:'‚úÖ M√∫lt ¬∑ √Åll√≠t√≥',  label:'m√∫lt id≈ë √°ll√≠t√≥ alakja'},
  'past-neg':   {key:'past_neg',    badge:'‚ùå M√∫lt ¬∑ Tagad√≥',  label:'m√∫lt id≈ë tagad√≥ alakja'},
};

const DIFF_CFG = {
  easy:  {time:0,  xpBase:10, xpBonus:5,  penalty:5,  hintCost:0,  xpMult:1},
  normal:{time:20, xpBase:15, xpBonus:10, penalty:8,  hintCost:5,  xpMult:1},
  hard:  {time:10, xpBase:25, xpBonus:20, penalty:15, hintCost:999,xpMult:2},
};

const ACHIEVEMENTS = [
  {id:'first',    icon:'üåü', name:'Els≈ë helyes!',      desc:'Az els≈ë helyes v√°laszt megkaptad.',         chk:s=>s.correct>=1},
  {id:'streak5',  icon:'üî•', name:'5-√∂s sorozat!',     desc:'5 egym√°st k√∂vet≈ë helyes v√°lasz.',            chk:s=>s.maxStreak>=5},
  {id:'streak10', icon:'üåã', name:'T√ºzes!',            desc:'10-es sorozat ‚Äì leny≈±g√∂z≈ë!',                chk:s=>s.maxStreak>=10},
  {id:'nohint',   icon:'üß†', name:'Seg√≠ts√©g n√©lk√ºl!',  desc:'A teljes j√°t√©kot seg√≠ts√©g n√©lk√ºl teljes√≠tetted.', chk:s=>s.hintUsed===0&&s.total>=5},
  {id:'perfect',  icon:'üëë', name:'T√∂k√©letes!',        desc:'100% pontoss√°g legal√°bb 10 k√©rd√©sn√©l.',     chk:s=>s.pct===100&&s.total>=10},
  {id:'speed',    icon:'‚ö°', name:'Vill√°mgyors',       desc:'√Åtlag 5 mp alatt v√°laszolt√°l.',              chk:s=>s.avgTime>0&&s.avgTime<=5},
  {id:'grind25',  icon:'üìö', name:'Szorgalmas',        desc:'25 k√©rd√©st megv√°laszolt√°l.',                 chk:s=>s.total>=25},
  {id:'lvl3',     icon:'üöÄ', name:'Halad√≥ szint',      desc:'El√©rted a 3. szintet.',                     chk:s=>s.level>=3},
];

const XP_PER_LVL = 100;
const PASS_PCT   = 60;

// ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê
let selMode = 'all';
let selDiff = 'normal';
let queue=[], qi=0, answered=false;
let correct=0, wrong=0, streak=0, maxStreak=0;
let xp=0, level=1, hintUsed=0;
let timerInt=null, timeLeft=0;
let totalTime=0, ansCount=0, qStart=0;
let sessionAch=[];

// ‚ïê‚ïê‚ïê WELCOME ‚ïê‚ïê‚ïê
function selectMode(el){
  document.querySelectorAll('.mode-pill').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  selMode = el.dataset.mode;
}

function selectDiff(d, el){
  selDiff = d;
  document.querySelectorAll('.diff-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
}

function startGame(){
  correct=0;wrong=0;streak=0;maxStreak=0;
  xp=0;level=1;hintUsed=0;totalTime=0;ansCount=0;sessionAch=[];
  queue = buildQueue();
  qi = 0;
  showScreen('gameScreen');
  // sync game mode bar
  document.querySelectorAll('.mode-chip').forEach(c=>{
    c.classList.toggle('active', c.dataset.mode===selMode);
  });
  updateHUD();
  showQ();
}

function restartSame(){ startGame(); }
function goMenu(){ showScreen('welcomeScreen'); }
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function buildQueue(){
  const types = selMode==='all' ? Object.keys(QT) : [selMode];
  let items=[];
  verbs.forEach(v=>types.forEach(t=>items.push({v,t})));
  for(let i=items.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [items[i],items[j]]=[items[j],items[i]];
  }
  return items;
}

function changeMode(el){
  document.querySelectorAll('.mode-chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  selMode = el.dataset.mode;
  queue = buildQueue();
  qi = 0;
  showQ();
}

// ‚ïê‚ïê‚ïê TIMER ‚ïê‚ïê‚ïê
function startTimer(){
  clearInterval(timerInt);
  const cfg = DIFF_CFG[selDiff];
  const arc = document.getElementById('timerArc');
  const txt = document.getElementById('timerTxt');
  if(!cfg.time){
    txt.textContent='‚àû'; txt.className='timer-text';
    arc.style.strokeDashoffset=0; arc.className='timer-fg';
    return;
  }
  timeLeft = cfg.time;
  updateTimerUI();
  timerInt = setInterval(()=>{
    timeLeft--;
    updateTimerUI();
    if(timeLeft<=0){ clearInterval(timerInt); timeExpired(); }
  },1000);
}

function updateTimerUI(){
  const cfg = DIFF_CFG[selDiff];
  const ratio = timeLeft / (cfg.time||1);
  const arc = document.getElementById('timerArc');
  const txt = document.getElementById('timerTxt');
  arc.style.strokeDashoffset = 107 * (1-ratio);
  const cls = ratio>0.5?'':'warn';
  const dangerous = ratio<=0.25;
  arc.className = 'timer-fg'+(dangerous?' danger':ratio>0.5?'':' warn');
  txt.className  = 'timer-text'+(dangerous?' danger':ratio>0.5?'':' warn');
  txt.textContent = timeLeft;
}

function timeExpired(){
  if(answered) return;
  const {v,t} = queue[qi];
  wrong++; streak=0; updateHUD();
  flashBg('rgba(220,38,38,0.12)');
  const inp = document.getElementById('ansInput');
  inp.classList.add('wrong','shake'); inp.disabled=true;
  setFeedback('wrong',`‚è∞ Lej√°rt! Helyes: <strong>${v[QT[t].key]}</strong>`);
  document.getElementById('nextBtn').style.display='block';
  document.getElementById('checkBtn').disabled=true;
  answered=true;
  recordTime();
}

// ‚ïê‚ïê‚ïê QUESTION ‚ïê‚ïê‚ïê
function showQ(){
  if(qi>=queue.length){ endGame(); return; }
  answered=false;
  const {v,t} = queue[qi];
  const qt = QT[t];
  document.getElementById('qNum').textContent = `Q ${qi+1} / ${queue.length}`;
  document.getElementById('verbKanji').textContent  = v.dict;
  document.getElementById('verbGroup').textContent  = `${v.group}. csoport`;
  document.getElementById('verbMeaning').textContent= v.meaning;
  document.getElementById('typeBadge').textContent  = qt.badge;
  document.getElementById('qText').textContent      = `Mi a(z) „Äå${v.dict}„Äç ige ${qt.label}?`;
  document.getElementById('hintTxt').textContent = '';
  document.getElementById('hintToggle').checked = false;

  const cfg = DIFF_CFG[selDiff];
  const hr = document.getElementById('hintRow');
  hr.style.display = selDiff==='hard' ? 'none' : '';
  document.getElementById('hintCost').textContent = cfg.hintCost>0 ? `(‚Äì${cfg.hintCost} XP)` : '(ingyenes)';

  const inp = document.getElementById('ansInput');
  inp.value=''; inp.className='answer-input'; inp.disabled=false; inp.focus();
  document.getElementById('feedback').textContent='';
  document.getElementById('feedback').className='feedback-area';
  document.getElementById('nextBtn').style.display='none';
  document.getElementById('checkBtn').disabled=false;

  updateProgress();
  startTimer();
  qStart = Date.now();

  // re-animate card
  const card = document.getElementById('questionCard');
  card.style.animation='none'; card.offsetHeight; card.style.animation='';
}

function recordTime(){
  totalTime += (Date.now()-qStart)/1000;
  ansCount++;
}

function onKey(e){
  if(e.key==='Enter'){ if(!answered) checkAnswer(); else nextQ(); }
}

// ‚ïê‚ïê‚ïê CHECK ‚ïê‚ïê‚ïê
function checkAnswer(){
  if(answered) return;
  clearInterval(timerInt);
  const inp = document.getElementById('ansInput');
  const ua = inp.value.trim();
  if(!ua){ inp.focus(); return; }

  const {v,t} = queue[qi];
  const correctAns = v[QT[t].key];
  const hKey = 'h_' + t.replace('-', '_');  // 'present-pos' ‚Üí 'h_present_pos'
  const hiraganaAns = v[hKey] || '';
  const cfg = DIFF_CFG[selDiff];

  answered=true; inp.disabled=true;
  document.getElementById('checkBtn').disabled=true;
  recordTime();

  const isCorrect = (ua === correctAns) || (hiraganaAns && ua === hiraganaAns);

  if(isCorrect){
    correct++; streak++; if(streak>maxStreak) maxStreak=streak;
    const bonus = streak>=3 ? cfg.xpBonus : 0;
    const gained = (cfg.xpBase + bonus) * cfg.xpMult;
    addXP(gained, inp);
    inp.classList.add('correct');
    setFeedback('correct', streak>=3
      ? `‚úì Helyes! üî• √ó${streak} sorozat! (+${gained} XP)`
      : `‚úì Helyes! (+${gained} XP)`);
    flashBg('rgba(16,185,129,0.18)');
    checkAchievements();
  } else {
    wrong++; streak=0;
    addXP(-cfg.penalty);
    inp.classList.add('wrong','shake');
    const hint = hiraganaAns ? ` („Å≤„Çâ„Åå„Å™: ${hiraganaAns})` : '';
    setFeedback('wrong',`‚úó Helytelen ‚Äî Helyes: <strong>${correctAns}</strong>${hint}`);
    flashBg('rgba(220,38,38,0.12)');
  }
  updateHUD();
  document.getElementById('nextBtn').style.display='block';
}

function toggleHint(){
  const on = document.getElementById('hintToggle').checked;
  if(!on){ document.getElementById('hintTxt').textContent=''; return; }
  const {v,t} = queue[qi];
  const hKey = 'h_' + t.replace('-', '_');
  const hAns = v[hKey] || v[QT[t].key];
  document.getElementById('hintTxt').textContent = `‚Üí ${hAns.slice(0,-1)}‚Ä¶`;
  if(!answered){
    hintUsed++;
    const cost = DIFF_CFG[selDiff].hintCost;
    if(cost>0) addXP(-cost);
  }
}

function skipQ(){
  if(!answered){ wrong++; streak=0; addXP(-DIFF_CFG[selDiff].penalty); updateHUD(); }
  clearInterval(timerInt); qi++; showQ();
}
function nextQ(){ qi++; showQ(); }

// ‚ïê‚ïê‚ïê XP & LEVEL ‚ïê‚ïê‚ïê
function addXP(amount, inputEl){
  xp = Math.max(0, xp+amount);
  while(xp>=XP_PER_LVL){ xp-=XP_PER_LVL; level++; showToast('üöÄ','Szint n√∂veked√©s!',`El√©rted a(z) ${level}. szintet!`); }
  updateHUD();
  if(amount>0 && inputEl) spawnXPPopup(amount, inputEl);
}

function spawnXPPopup(n, el){
  const rect = el.getBoundingClientRect();
  const pop = document.createElement('div');
  pop.className='xp-popup'; pop.textContent=`+${n} XP`;
  pop.style.left=`${rect.left+rect.width/2-30}px`;
  pop.style.top =`${rect.top-10}px`;
  document.body.appendChild(pop);
  setTimeout(()=>pop.remove(),1200);
}

function updateHUD(){
  document.getElementById('levelBadge').textContent = `LVL ${level}`;
  document.getElementById('xpLabel').textContent    = `${xp} / ${XP_PER_LVL}`;
  document.getElementById('xpBar').style.width      = `${xp/XP_PER_LVL*100}%`;
  document.getElementById('hudC').textContent = correct;
  document.getElementById('hudW').textContent = wrong;
  document.getElementById('streakNum').textContent = streak;
  const sp = document.getElementById('streakPill');
  sp.className = streak>=3 ? 'streak-pill hot' : 'streak-pill';
}

function updateProgress(){
  const pct = qi/queue.length*100;
  document.getElementById('questBar').style.width = `${pct}%`;
  document.getElementById('questLbl').textContent = `${qi} / ${queue.length}`;
}

// ‚ïê‚ïê‚ïê FEEDBACK ‚ïê‚ïê‚ïê
function setFeedback(type, html){
  const fb = document.getElementById('feedback');
  fb.className = `feedback-area ${type}`;
  fb.innerHTML = html;
}

function flashBg(color){
  const el=document.createElement('div');
  el.className='flash-el'; el.style.background=color;
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),400);
}

// ‚ïê‚ïê‚ïê ACHIEVEMENTS ‚ïê‚ïê‚ïê
function checkAchievements(){
  const total = correct+wrong;
  const s={correct,wrong,streak,maxStreak,total,hintUsed,level,
            pct:total?Math.round(correct/total*100):0,
            avgTime:ansCount?totalTime/ansCount:0};
  ACHIEVEMENTS.forEach(a=>{
    if(!sessionAch.find(x=>x.id===a.id) && a.chk(s)){
      sessionAch.push(a);
      setTimeout(()=>showToast(a.icon,a.name,a.desc),300);
    }
  });
}

function showToast(icon,name,desc){
  const t=document.createElement('div');
  t.className='achievement-toast';
  t.innerHTML=`<div class="toast-icon">${icon}</div>
    <div><div class="toast-title">üèÜ Eredm√©ny feloldva!</div>
    <div class="toast-name">${name}</div>
    <div class="toast-desc">${desc}</div></div>`;
  document.body.appendChild(t);
  setTimeout(()=>{
    t.style.transition='opacity .5s,transform .5s';
    t.style.opacity='0'; t.style.transform='translateX(120%)';
    setTimeout(()=>t.remove(),500);
  },2800);
}

// ‚ïê‚ïê‚ïê END ‚ïê‚ïê‚ïê
function endGame(){
  clearInterval(timerInt);
  checkAchievements(); // final check
  const total=correct+wrong;
  const pct=total?Math.round(correct/total*100):0;
  const passed=pct>=PASS_PCT;
  const avgTime=ansCount?(totalTime/ansCount).toFixed(1):'‚Äî';
  const totalXP=xp+(level-1)*XP_PER_LVL;

  let grade,gtitle,gmsg;
  if(pct>=90){grade='A';gtitle='Kiv√°l√≥!';gmsg='Mesteri teljes√≠tm√©ny ‚Äì fantasztikus!';}
  else if(pct>=80){grade='B';gtitle='Nagyon j√≥!';gmsg='Sz√©p munka, csak √≠gy tov√°bb!';}
  else if(pct>=70){grade='C';gtitle='J√≥!';gmsg='Meg√°lltad a helyed ‚Äì √©rdemes m√©g gyakorolni!';}
  else if(pct>=60){grade='D';gtitle='Megfelel≈ë';gmsg='√Åtment√©l, de van hova fejl≈ëdni.';}
  else{grade='F';gtitle='Nem siker√ºlt...';gmsg='Ne add fel! Pr√≥b√°ld meg √∫jra!';}

  const gl=document.getElementById('gradeLetter');
  gl.textContent=grade; gl.className=`grade-letter grade-${grade}`;
  document.getElementById('gradeTitle').textContent=gtitle;
  document.getElementById('gradeMsg').textContent=gmsg;

  const pb=document.getElementById('passBanner');
  if(passed){
    pb.className='pass-banner passed';
    pb.innerHTML=`üéâ MEGFELELT√âL! ${pct}% ‚Äî sikeresen teljes√≠tetted a(z) <strong>${selDiff==='easy'?'K√∂nny≈±':selDiff==='normal'?'Norm√°l':'Neh√©z'}</strong> m√≥dot!`;
  } else {
    pb.className='pass-banner failed';
    pb.innerHTML=`üò¢ NEM SIKER√úLT ‚Äî ${pct}% (minimum: ${PASS_PCT}%) ‚Äî pr√≥b√°ld meg √∫jra!`;
  }

  document.getElementById('rC').textContent=correct;
  document.getElementById('rW').textContent=wrong;
  document.getElementById('rPct').textContent=`${pct}%`;
  document.getElementById('rXP').textContent=totalXP;
  document.getElementById('rStreak').textContent=maxStreak;
  document.getElementById('rTime').textContent=avgTime!=='‚Äî'?`${avgTime}mp`:'‚Äî';

  const achSec=document.getElementById('achSection');
  if(sessionAch.length>0){
    achSec.style.display='';
    document.getElementById('achList').innerHTML=
      sessionAch.map(a=>`<div class="ach-badge">${a.icon} ${a.name}</div>`).join('');
  } else { achSec.style.display='none'; }

  showScreen('resultScreen');
  if(passed) launchConfetti();
}

// ‚ïê‚ïê‚ïê CONFETTI ‚ïê‚ïê‚ïê
function launchConfetti(){
  const colors=['#f59e0b','#a855f7','#10b981','#3b82f6','#ec4899','#fff','#06b6d4'];
  for(let i=0;i<90;i++){
    setTimeout(()=>{
      const el=document.createElement('div');
      el.className='confetti-piece';
      el.style.cssText=`left:${Math.random()*100}vw;top:-20px;
        background:${colors[Math.floor(Math.random()*colors.length)]};
        width:${6+Math.random()*8}px;height:${6+Math.random()*8}px;
        border-radius:${Math.random()>.5?'50%':'2px'};
        animation-duration:${2+Math.random()*3}s;
        animation-delay:${Math.random()*.4}s;`;
      document.body.appendChild(el);
      setTimeout(()=>el.remove(),5000);
    },i*25);
  }
}
</script>
</body>
</html>
