<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>N5 Jap√°n Ig√©k ‚Äì Koppints r√°!</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Inter:wght@400;600;700&display=swap');
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    min-height: 100vh;
    background: linear-gradient(160deg, #fefce8 0%, #fef9c3 50%, #fef3c7 100%);
    display: flex; align-items: center; justify-content: center;
    font-family: 'Inter', sans-serif;
    color: #1c1917;
  }

  .container { text-align: center; width: 100%; max-width: 640px; padding: 20px; }

  h1 { font-size: 1.6rem; margin-bottom: 4px; color: #b45309; letter-spacing: 1px; }
  .subtitle { color: #78716c; font-size: 0.85rem; margin-bottom: 22px; }

  /* ‚îÄ‚îÄ HUD ‚îÄ‚îÄ */
  .hud {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 18px;
    background: rgba(255,255,255,0.7);
    border: 1px solid #fde68a;
    border-radius: 14px; padding: 10px 18px;
    box-shadow: 0 2px 8px rgba(180,120,0,0.08);
  }
  .hud-item span { display: block; font-size: 0.65rem; color: #a16207; text-transform: uppercase; letter-spacing: 1px; }
  .hud-item strong { font-size: 1.3rem; color: #1c1917; }
  .lives { font-size: 1.3rem; }

  /* ‚îÄ‚îÄ Mode tabs ‚îÄ‚îÄ */
  .mode-tabs {
    display: flex; gap: 6px; margin-bottom: 14px;
    background: rgba(255,255,255,0.6);
    border: 1px solid #fde68a;
    border-radius: 14px; padding: 6px;
    box-shadow: 0 2px 8px rgba(180,120,0,0.06);
  }
  .mode-tab {
    flex: 1; padding: 9px 4px; border: none; border-radius: 10px;
    cursor: pointer; font-size: 0.78rem; font-weight: 600;
    background: transparent; color: #78716c;
    transition: all 0.18s;
    line-height: 1.3;
  }
  .mode-tab .jp-label { display: block; font-family: 'Noto Sans JP', sans-serif; font-size: 0.85rem; }
  .mode-tab .hu-label { display: block; font-size: 0.68rem; color: #a8a29e; margin-top: 2px; }
  .mode-tab.active {
    background: #b45309; color: #fff;
    box-shadow: 0 3px 10px rgba(180,83,9,0.3);
  }
  .mode-tab.active .hu-label { color: #fde68a; }

  /* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
  .card {
    background: rgba(255,255,255,0.82);
    border: 1px solid #fde68a;
    border-radius: 20px; padding: 32px 28px;
    margin-bottom: 16px;
    box-shadow: 0 4px 20px rgba(180,120,0,0.1);
  }

  .label { font-size: 0.7rem; color: #a16207; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 8px; }

  .hungarian { font-size: 2.1rem; font-weight: 700; color: #92400e; margin-bottom: 4px; min-height: 52px; }

  .romaji { font-size: 0.88rem; color: #a8a29e; margin-bottom: 22px; height: 20px; }

  /* ‚îÄ‚îÄ Timer bar ‚îÄ‚îÄ */
  .timer-bar-wrap {
    background: #fef3c7; border-radius: 99px; height: 6px;
    margin-bottom: 38px; overflow: hidden;
  }
  .timer-bar {
    height: 100%; border-radius: 99px;
    background: linear-gradient(90deg, #ef4444, #f59e0b);
    transition: width 0.1s linear;
  }

  /* ‚îÄ‚îÄ Verb display + furigana ‚îÄ‚îÄ */
  .verb-display {
    font-family: 'Noto Sans JP', sans-serif; font-weight: 700;
    min-height: 120px;
    display: flex; align-items: flex-end; justify-content: center;
    padding-bottom: 6px;
    transition: opacity 0.28s ease, transform 0.28s ease;
    color: #1c1917;
  }
  .verb-display.fade { opacity: 0; transform: scale(0.84); }

  .verb-display ruby { display: inline-flex; flex-direction: column; align-items: center; gap: 3px; }
  .verb-display ruby rt {
    font-size: 1.0rem; font-weight: 400;
    color: #2563eb; letter-spacing: 2px; line-height: 1;
    order: -1;
  }
  .verb-display .kanji-text { font-size: 3rem; letter-spacing: 3px; line-height: 1; }
  .verb-display .kana-only  { font-size: 3rem; letter-spacing: 4px; line-height: 1; padding-top: 36px; }

  /* ‚îÄ‚îÄ HIT button ‚îÄ‚îÄ */
  .hit-btn {
    width: 100%; padding: 18px;
    font-size: 1.2rem; font-weight: 700; border: none; border-radius: 14px;
    cursor: pointer;
    background: linear-gradient(135deg, #e94560, #c0392b);
    color: #fff; letter-spacing: 1px;
    box-shadow: 0 6px 20px rgba(233,69,96,0.3);
    transition: transform 0.1s, box-shadow 0.1s;
    margin-bottom: 14px;
  }
  .hit-btn:active { transform: scale(0.96); box-shadow: 0 3px 10px rgba(233,69,96,0.25); }
  .hit-btn:disabled { background: #d4d4d4; color: #a8a29e; box-shadow: none; cursor: default; }

  /* ‚îÄ‚îÄ Feedback ‚îÄ‚îÄ */
  .feedback { font-size: 1.0rem; font-weight: 700; min-height: 28px; font-family: 'Noto Sans JP', sans-serif; }
  .feedback.correct { color: #15803d; }
  .feedback.wrong   { color: #dc2626; }
  .feedback.missed  { color: #c2410c; }

  .instruction { font-size: 0.78rem; color: #a8a29e; margin-top: 12px; }

  /* ‚îÄ‚îÄ Overlays ‚îÄ‚îÄ */
  .overlay {
    position: fixed; inset: 0;
    background: rgba(28,25,23,0.7);
    display: flex; align-items: center; justify-content: center;
    z-index: 99; backdrop-filter: blur(4px);
  }
  .overlay-card {
    background: #fffbeb; border: 1px solid #fde68a;
    border-radius: 24px; padding: 44px 36px;
    text-align: center; max-width: 420px; width: 90%;
    box-shadow: 0 20px 60px rgba(0,0,0,0.2);
  }
  .overlay-card h2 { font-size: 2rem; margin-bottom: 10px; color: #92400e; }
  .overlay-card p  { color: #78716c; margin-bottom: 20px; line-height: 1.7; font-size: 0.95rem; }
  .overlay-card .score-big { font-size: 3rem; font-weight: 700; color: #b45309; margin: 12px 0; }
  .start-btn {
    padding: 15px 40px; font-size: 1.1rem; font-weight: 700;
    border: none; border-radius: 12px;
    background: linear-gradient(135deg, #e94560, #c0392b);
    color: #fff; cursor: pointer; letter-spacing: 1px;
    box-shadow: 0 6px 20px rgba(233,69,96,0.35);
    transition: transform 0.1s;
  }
  .start-btn:hover { transform: scale(1.04); }

  .mode-hint {
    display: inline-block;
    background: #fef9c3; border: 1px solid #fde68a;
    border-radius: 8px; padding: 6px 14px;
    font-size: 0.8rem; color: #92400e; margin-bottom: 18px;
  }

  .back-btn {
    display: inline-flex; align-items: center; gap: 6px;
    margin-bottom: 16px;
    padding: 8px 18px;
    font-size: 0.85rem; font-weight: 600;
    border: 1.5px solid #fde68a;
    border-radius: 10px;
    background: rgba(255,255,255,0.7);
    color: #92400e;
    cursor: pointer;
    text-decoration: none;
    transition: background 0.15s, box-shadow 0.15s;
    box-shadow: 0 2px 8px rgba(180,120,0,0.07);
  }
  .back-btn:hover {
    background: #fef9c3;
    box-shadow: 0 4px 12px rgba(180,120,0,0.13);
  }
</style>
</head>
<body>

<!-- START OVERLAY -->
<div class="overlay" id="startOverlay">
  <div class="overlay-card">
    <h2>üáØüáµ N5 Jap√°n Ig√©k</h2>
    <p>V√°lassz ragoz√°si alakot a <strong style="color:#b45309">f√ºlek</strong> seg√≠ts√©g√©vel!<br>
       Megjelenik a <strong style="color:#92400e">magyar alak</strong>, jap√°n ig√©k peregnek ‚Äì koppints <strong style="color:#e94560">HIT!</strong>-re, amikor a helyes l√°that√≥!<br><br>
       A kanji felett <strong style="color:#2563eb">hiragana</strong> olvasat seg√≠t. 3 √©letpont ‚Äì ne hib√°zz!</p>
    <button class="start-btn" onclick="startGame()">J√°t√©k ind√≠t√°sa!</button>
  </div>
</div>

<!-- GAME OVER OVERLAY -->
<div class="overlay" id="gameoverOverlay" style="display:none">
  <div class="overlay-card">
    <h2 id="goTitle">J√°t√©k v√©ge!</h2>
    <p id="goMsg"></p>
    <div class="score-big" id="goScore"></div>
    <button class="start-btn" onclick="startGame()">√öjra!</button>
  </div>
</div>

<!-- MAIN -->
<div class="container">
  <a href="index.html" class="back-btn">‚Üê Vissza a f≈ëoldalra</a>
  <h1>N5 Jap√°n Ig√©k</h1>
  <div class="subtitle">Udvarias igealakok ‚Äì „Åæ„ÅôÂΩ¢</div>

  <div class="hud">
    <div class="hud-item"><span>Pontsz√°m</span><strong id="score">0</strong></div>
    <div class="hud-item"><span>Sorozat</span><strong id="streak">0</strong> üî•</div>
    <div class="hud-item"><span>√âletek</span><div class="lives" id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div></div>
    <div class="hud-item"><span>K√©rd√©s</span><strong><span id="qnum">0</span>/20</strong></div>
  </div>

  <!-- Mode selector -->
  <div class="mode-tabs">
    <button class="mode-tab active" onclick="setMode('masu')" id="tab-masu">
      <span class="jp-label">„Äú„Åæ„Åô</span>
      <span class="hu-label">Udvarias jelen</span>
    </button>
    <button class="mode-tab" onclick="setMode('masen')" id="tab-masen">
      <span class="jp-label">„Äú„Åæ„Åõ„Çì</span>
      <span class="hu-label">Jelen tagad√°s</span>
    </button>
    <button class="mode-tab" onclick="setMode('mashita')" id="tab-mashita">
      <span class="jp-label">„Äú„Åæ„Åó„Åü</span>
      <span class="hu-label">M√∫lt id≈ë</span>
    </button>
    <button class="mode-tab" onclick="setMode('masendeshita')" id="tab-masendeshita">
      <span class="jp-label">„Äú„Åæ„Åõ„Çì„Åß„Åó„Åü</span>
      <span class="hu-label">M√∫lt tagad√°s</span>
    </button>
  </div>

  <div class="card">
    <div class="label">Magyar alak</div>
    <div class="hungarian" id="hungMeaning">‚Äì</div>
    <div class="romaji" id="romajiHint"></div>

    <div class="timer-bar-wrap">
      <div class="timer-bar" id="timerBar" style="width:100%"></div>
    </div>

    <div class="verb-display" id="verbDisplay">‚Äì</div>
  </div>

  <button class="hit-btn" id="hitBtn" onclick="onHit()" disabled>üéØ HIT!</button>
  <div class="feedback" id="feedback"></div>
  <div class="instruction">V√°rd meg a helyes ig√©t, majd nyomj HIT-et! T√©ves koppint√°s = 1 √©let.</div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ MODE DEFINITIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const MODES = {
  masu:         { suffix: "„Åæ„Åô",         suffixHi: "„Åæ„Åô",         huIdx: 0 },
  masen:        { suffix: "„Åæ„Åõ„Çì",       suffixHi: "„Åæ„Åõ„Çì",       huIdx: 1 },
  mashita:      { suffix: "„Åæ„Åó„Åü",       suffixHi: "„Åæ„Åó„Åü",       huIdx: 2 },
  masendeshita: { suffix: "„Åæ„Åõ„Çì„Åß„Åó„Åü", suffixHi: "„Åæ„Åõ„Çì„Åß„Åó„Åü", huIdx: 3 },
};
let currentMode = 'masu';

// ‚îÄ‚îÄ‚îÄ N5 VERB DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// stem    = kanji „Åæ„ÅôË™ûÂππ (e.g. È£ü„Åπ for È£ü„Åπ„Åæ„Åô)
// stemHi  = hiragana „Åæ„ÅôË™ûÂππ
// hu[4]   = [jelen, jelen_tagad√°s, m√∫lt, m√∫lt_tagad√°s]  ‚Äì 1. sz. egyes
const VERBS = [
  { jp:"È£ü„Åπ„Çã",   hi:"„Åü„Åπ„Çã",         stem:"È£ü„Åπ",     stemHi:"„Åü„Åπ",
    hu:["eszem","nem eszem","ettem","nem ettem"] },
  { jp:"È£≤„ÇÄ",     hi:"„ÅÆ„ÇÄ",           stem:"È£≤„Åø",     stemHi:"„ÅÆ„Åø",
    hu:["iszom","nem iszom","ittam","nem ittam"] },
  { jp:"Ë°å„Åè",     hi:"„ÅÑ„Åè",           stem:"Ë°å„Åç",     stemHi:"„ÅÑ„Åç",
    hu:["megyek","nem megyek","mentem","nem mentem"] },
  { jp:"Êù•„Çã",     hi:"„Åè„Çã",           stem:"Êù•",       stemHi:"„Åç",
    hu:["j√∂v√∂k","nem j√∂v√∂k","j√∂ttem","nem j√∂ttem"] },
  { jp:"Ë¶ã„Çã",     hi:"„Åø„Çã",           stem:"Ë¶ã",       stemHi:"„Åø",
    hu:["n√©zek","nem n√©zek","n√©ztem","nem n√©ztem"] },
  { jp:"ËÅû„Åè",     hi:"„Åç„Åè",           stem:"ËÅû„Åç",     stemHi:"„Åç„Åç",
    hu:["hallgatok","nem hallgatok","hallgattam","nem hallgattam"] },
  { jp:"Ë©±„Åô",     hi:"„ÅØ„Å™„Åô",         stem:"Ë©±„Åó",     stemHi:"„ÅØ„Å™„Åó",
    hu:["besz√©lek","nem besz√©lek","besz√©ltem","nem besz√©ltem"] },
  { jp:"Ë™≠„ÇÄ",     hi:"„Çà„ÇÄ",           stem:"Ë™≠„Åø",     stemHi:"„Çà„Åø",
    hu:["olvasok","nem olvasok","olvastam","nem olvastam"] },
  { jp:"Êõ∏„Åè",     hi:"„Åã„Åè",           stem:"Êõ∏„Åç",     stemHi:"„Åã„Åç",
    hu:["√≠rok","nem √≠rok","√≠rtam","nem √≠rtam"] },
  { jp:"Ë≤∑„ÅÜ",     hi:"„Åã„ÅÜ",           stem:"Ë≤∑„ÅÑ",     stemHi:"„Åã„ÅÑ",
    hu:["veszek","nem veszek","vettem","nem vettem"] },
  { jp:"Â£≤„Çã",     hi:"„ÅÜ„Çã",           stem:"Â£≤„Çä",     stemHi:"„ÅÜ„Çä",
    hu:["eladok","nem adok el","eladtam","nem adtam el"] },
  { jp:"Â∏∞„Çã",     hi:"„Åã„Åà„Çã",         stem:"Â∏∞„Çä",     stemHi:"„Åã„Åà„Çä",
    hu:["hazamegyek","nem megyek haza","hazamentem","nem mentem haza"] },
  { jp:"Ëµ∑„Åç„Çã",   hi:"„Åä„Åç„Çã",         stem:"Ëµ∑„Åç",     stemHi:"„Åä„Åç",
    hu:["felkelek","nem kelek fel","felkeltem","nem keltem fel"] },
  { jp:"ÂØù„Çã",     hi:"„Å≠„Çã",           stem:"ÂØù",       stemHi:"„Å≠",
    hu:["alszom","nem alszom","aludtam","nem aludtam"] },
  { jp:"„Åô„Çã",     hi:"„Åô„Çã",           stem:"„Åó",       stemHi:"„Åó",
    hu:["csin√°lok","nem csin√°lok","csin√°ltam","nem csin√°ltam"] },
  { jp:"„ÅÇ„Çã",     hi:"„ÅÇ„Çã",           stem:"„ÅÇ„Çä",     stemHi:"„ÅÇ„Çä",
    hu:["van","nincs","volt","nem volt"] },
  { jp:"„ÅÑ„Çã",     hi:"„ÅÑ„Çã",           stem:"„ÅÑ",       stemHi:"„ÅÑ",
    hu:["vagyok","nem vagyok","voltam","nem voltam"] },
  { jp:"ÂàÜ„Åã„Çã",   hi:"„Çè„Åã„Çã",         stem:"ÂàÜ„Åã„Çä",   stemHi:"„Çè„Åã„Çä",
    hu:["meg√©rtek","nem √©rtek","meg√©rtettem","nem √©rtettem"] },
  { jp:"‰Ωú„Çã",     hi:"„Å§„Åè„Çã",         stem:"‰Ωú„Çä",     stemHi:"„Å§„Åè„Çä",
    hu:["k√©sz√≠tek","nem k√©sz√≠tek","k√©sz√≠tettem","nem k√©sz√≠tettem"] },
  { jp:"Èñã„Åë„Çã",   hi:"„ÅÇ„Åë„Çã",         stem:"Èñã„Åë",     stemHi:"„ÅÇ„Åë",
    hu:["kinyitom","nem nyitom ki","kinyitottam","nem nyitottam ki"] },
  { jp:"Èñâ„ÇÅ„Çã",   hi:"„Åó„ÇÅ„Çã",         stem:"Èñâ„ÇÅ",     stemHi:"„Åó„ÇÅ",
    hu:["bez√°rom","nem z√°rom be","bez√°rtam","nem z√°rtam be"] },
  { jp:"ÂÖ•„Çã",     hi:"„ÅØ„ÅÑ„Çã",         stem:"ÂÖ•„Çä",     stemHi:"„ÅØ„ÅÑ„Çä",
    hu:["bemegyek","nem megyek be","bementem","nem mentem be"] },
  { jp:"Âá∫„Çã",     hi:"„Åß„Çã",           stem:"Âá∫",       stemHi:"„Åß",
    hu:["kimegyek","nem megyek ki","kimentem","nem mentem ki"] },
  { jp:"‰Ωø„ÅÜ",     hi:"„Å§„Åã„ÅÜ",         stem:"‰Ωø„ÅÑ",     stemHi:"„Å§„Åã„ÅÑ",
    hu:["haszn√°lok","nem haszn√°lok","haszn√°ltam","nem haszn√°ltam"] },
  { jp:"ÊÄù„ÅÜ",     hi:"„Åä„ÇÇ„ÅÜ",         stem:"ÊÄù„ÅÑ",     stemHi:"„Åä„ÇÇ„ÅÑ",
    hu:["gondolok","nem gondolok","gondoltam","nem gondoltam"] },
  { jp:"ÊåÅ„Å§",     hi:"„ÇÇ„Å§",           stem:"ÊåÅ„Å°",     stemHi:"„ÇÇ„Å°",
    hu:["hordozok","nem hordozok","hordoztam","nem hordoztam"] },
  { jp:"Áü•„Çã",     hi:"„Åó„Çã",           stem:"Áü•„Çä",     stemHi:"„Åó„Çä",
    hu:["tudok","nem tudok","tudtam","nem tudtam"] },
  { jp:"‰ºö„ÅÜ",     hi:"„ÅÇ„ÅÜ",           stem:"‰ºö„ÅÑ",     stemHi:"„ÅÇ„ÅÑ",
    hu:["tal√°lkozom","nem tal√°lkozom","tal√°lkoztam","nem tal√°lkoztam"] },
  { jp:"ÂæÖ„Å§",     hi:"„Åæ„Å§",           stem:"ÂæÖ„Å°",     stemHi:"„Åæ„Å°",
    hu:["v√°rok","nem v√°rok","v√°rtam","nem v√°rtam"] },
  { jp:"‰πó„Çã",     hi:"„ÅÆ„Çã",           stem:"‰πó„Çä",     stemHi:"„ÅÆ„Çä",
    hu:["felsz√°llok","nem sz√°llok fel","felsz√°lltam","nem sz√°lltam fel"] },
  { jp:"Èôç„Çä„Çã",   hi:"„Åä„Çä„Çã",         stem:"Èôç„Çä",     stemHi:"„Åä„Çä",
    hu:["lesz√°llok","nem sz√°llok le","lesz√°lltam","nem sz√°lltam le"] },
  { jp:"ÂãâÂº∑„Åô„Çã", hi:"„Åπ„Çì„Åç„Çá„ÅÜ„Åô„Çã", stem:"ÂãâÂº∑„Åó",   stemHi:"„Åπ„Çì„Åç„Çá„ÅÜ„Åó",
    hu:["tanulok","nem tanulok","tanultam","nem tanultam"] },
  { jp:"ÂÉç„Åè",     hi:"„ÅØ„Åü„Çâ„Åè",       stem:"ÂÉç„Åç",     stemHi:"„ÅØ„Åü„Çâ„Åç",
    hu:["dolgozom","nem dolgozom","dolgoztam","nem dolgoztam"] },
  { jp:"Ê≥≥„Åê",     hi:"„Åä„Çà„Åê",         stem:"Ê≥≥„Åé",     stemHi:"„Åä„Çà„Åé",
    hu:["√∫szom","nem √∫szom","√∫sztam","nem √∫sztam"] },
  { jp:"Ëµ∞„Çã",     hi:"„ÅØ„Åó„Çã",         stem:"Ëµ∞„Çä",     stemHi:"„ÅØ„Åó„Çä",
    hu:["futok","nem futok","futottam","nem futottam"] },
  { jp:"Â∫ß„Çã",     hi:"„Åô„Çè„Çã",         stem:"Â∫ß„Çä",     stemHi:"„Åô„Çè„Çä",
    hu:["le√ºl√∂k","nem √ºl√∂k le","le√ºltem","nem √ºltem le"] },
  { jp:"Á´ã„Å§",     hi:"„Åü„Å§",           stem:"Á´ã„Å°",     stemHi:"„Åü„Å°",
    hu:["fel√°llok","nem √°llok fel","fel√°lltam","nem √°lltam fel"] },
  { jp:"Ê≠©„Åè",     hi:"„ÅÇ„Çã„Åè",         stem:"Ê≠©„Åç",     stemHi:"„ÅÇ„Çã„Åç",
    hu:["s√©t√°lok","nem s√©t√°lok","s√©t√°ltam","nem s√©t√°ltam"] },
  { jp:"Ê≠¢„Åæ„Çã",   hi:"„Å®„Åæ„Çã",         stem:"Ê≠¢„Åæ„Çä",   stemHi:"„Å®„Åæ„Çä",
    hu:["meg√°llok","nem √°llok meg","meg√°lltam","nem √°lltam meg"] },
  { jp:"Âßã„ÇÅ„Çã",   hi:"„ÅØ„Åò„ÇÅ„Çã",       stem:"Âßã„ÇÅ",     stemHi:"„ÅØ„Åò„ÇÅ",
    hu:["elkezdek","nem kezdek el","elkezdtem","nem kezdtem el"] },
  { jp:"ÁµÇ„Çè„Çã",   hi:"„Åä„Çè„Çã",         stem:"ÁµÇ„Çè„Çä",   stemHi:"„Åä„Çè„Çä",
    hu:["befejezek","nem fejezek be","befejeztem","nem fejeztem be"] },
  { jp:"Âøò„Çå„Çã",   hi:"„Çè„Åô„Çå„Çã",       stem:"Âøò„Çå",     stemHi:"„Çè„Åô„Çå",
    hu:["elfelejtem","nem felejtem el","elfelejtettem","nem felejtettem el"] },
  { jp:"Ë¶ö„Åà„Çã",   hi:"„Åä„Åº„Åà„Çã",       stem:"Ë¶ö„Åà",     stemHi:"„Åä„Åº„Åà",
    hu:["megjegyzem","nem jegyezm meg","megjegyeztem","nem jegyeztem meg"] },
  { jp:"Âá∫„Åô",     hi:"„Å†„Åô",           stem:"Âá∫„Åó",     stemHi:"„Å†„Åó",
    hu:["kiveszem","nem veszem ki","kivettem","nem vettem ki"] },
  { jp:"„ÇÇ„Çâ„ÅÜ",   hi:"„ÇÇ„Çâ„ÅÜ",         stem:"„ÇÇ„Çâ„ÅÑ",   stemHi:"„ÇÇ„Çâ„ÅÑ",
    hu:["kapok","nem kapok","kaptam","nem kaptam"] },
  { jp:"„ÅÇ„Åí„Çã",   hi:"„ÅÇ„Åí„Çã",         stem:"„ÅÇ„Åí",     stemHi:"„ÅÇ„Åí",
    hu:["adok","nem adok","adtam","nem adtam"] },
  { jp:"„Åè„Çå„Çã",   hi:"„Åè„Çå„Çã",         stem:"„Åè„Çå",     stemHi:"„Åè„Çå",
    hu:["ad nekem","nem ad nekem","adott nekem","nem adott nekem"] },
  { jp:"Ë≤∏„Åô",     hi:"„Åã„Åô",           stem:"Ë≤∏„Åó",     stemHi:"„Åã„Åó",
    hu:["k√∂lcs√∂nadok","nem adok k√∂lcs√∂n","k√∂lcs√∂nadtam","nem adtam k√∂lcs√∂n"] },
  { jp:"ÂÄü„Çä„Çã",   hi:"„Åã„Çä„Çã",         stem:"ÂÄü„Çä",     stemHi:"„Åã„Çä",
    hu:["k√∂lcs√∂nk√©rek","nem k√©rek k√∂lcs√∂n","k√∂lcs√∂nk√©rtem","nem k√©rtem k√∂lcs√∂n"] },
  { jp:"ÊÄ•„Åê",     hi:"„ÅÑ„Åù„Åê",         stem:"ÊÄ•„Åé",     stemHi:"„ÅÑ„Åù„Åé",
    hu:["sietek","nem sietek","siettem","nem siettem"] },
];

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function hasKanji(s) { return [...s].some(c => c >= '\u4E00' && c <= '\u9FFF'); }

function getConjugated(verb, mode) {
  const m = MODES[mode];
  return {
    jp: verb.stem + m.suffix,
    hi: verb.stemHi + m.suffixHi,
    hu: verb.hu[m.huIdx],
  };
}

function buildVerbHTML(jp, hi) {
  if (!hasKanji(jp)) return `<span class="kana-only">${jp}</span>`;
  return `<ruby><rt>${hi}</rt><span class="kanji-text">${jp}</span></ruby>`;
}

// ‚îÄ‚îÄ‚îÄ MODE SWITCHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setMode(mode) {
  currentMode = mode;
  document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + mode).classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ GAME STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TOTAL_Q = 20, CYCLE_MS = 4500, DISTRACTORS = 4;
let state = {};

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length-1; i>0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

function startGame() {
  document.getElementById('startOverlay').style.display    = 'none';
  document.getElementById('gameoverOverlay').style.display = 'none';
  state = { score:0, streak:0, lives:3, qnum:0, hitDone:false,
            cycleTimer:null, currentVerb:null, correctVerb:null,
            verbQueue:[], verbIdx:0 };
  updateHUD();
  nextQuestion();
}

function nextQuestion() {
  clearTimers();
  if (state.qnum >= TOTAL_Q || state.lives <= 0) { endGame(); return; }
  state.qnum++;
  state.hitDone = false;
  document.getElementById('hitBtn').disabled = false;
  setFeedback('','');
  document.getElementById('qnum').textContent = state.qnum;

  const shuffled    = shuffle(VERBS);
  state.correctVerb = shuffled[0];
  state.verbQueue   = shuffle([state.correctVerb, ...shuffled.slice(1, DISTRACTORS)]);

  // Show Hungarian form for current mode
  const conj = getConjugated(state.correctVerb, currentMode);
  document.getElementById('hungMeaning').textContent = conj.hu;
  document.getElementById('romajiHint').textContent  = '';

  state.verbIdx = 0;
  showVerb();
  startTimerBar();
}

function showVerb() {
  const display = document.getElementById('verbDisplay');
  display.classList.add('fade');
  setTimeout(() => {
    if (state.verbIdx >= state.verbQueue.length) state.verbIdx = 0;
    state.currentVerb = state.verbQueue[state.verbIdx++];
    const c = getConjugated(state.currentVerb, currentMode);
    display.innerHTML = buildVerbHTML(c.jp, c.hi);
    display.classList.remove('fade');
  }, 280);
  state.cycleTimer = setTimeout(() => { if (!state.hitDone) showVerb(); }, CYCLE_MS);
}

let barAnim;
function startTimerBar() {
  clearInterval(barAnim);
  const bar = document.getElementById('timerBar');
  const total = CYCLE_MS * state.verbQueue.length + 2000;
  const start = Date.now();
  bar.style.width = '100%';
  barAnim = setInterval(() => {
    const pct = Math.max(0, 100 - ((Date.now()-start)/total)*100);
    bar.style.width = pct + '%';
    if (pct <= 0) { clearInterval(barAnim); if (!state.hitDone) missedCorrect(); }
  }, 80);
}

function clearTimers() { clearTimeout(state.cycleTimer); clearInterval(barAnim); }

function onHit() {
  if (state.hitDone) return;
  const cv = state.currentVerb;
  if (!cv) return;
  const correct = getConjugated(state.correctVerb, currentMode);
  const chosen  = getConjugated(cv, currentMode);

  if (cv.jp === state.correctVerb.jp) {
    state.hitDone = true; clearTimers();
    const bonus = state.streak >= 3 ? 20 : 10;
    state.score += bonus; state.streak++;
    document.getElementById('hitBtn').disabled = true;
    document.getElementById('romajiHint').textContent = chosen.hi;
    setFeedback(`‚úÖ Helyes! ${chosen.jp} = ${correct.hu}„ÄÄ+${bonus}pont${bonus>10?' üî•':''}`, 'correct');
    updateHUD();
    setTimeout(nextQuestion, 1800);
  } else {
    state.lives--; state.streak = 0;
    setFeedback(`‚ùå T√©ves! ${chosen.jp}Ôºà${chosen.hi}Ôºâ= ${chosen.hu}`, 'wrong');
    updateHUD();
    if (state.lives <= 0) {
      clearTimers(); state.hitDone = true;
      document.getElementById('hitBtn').disabled = true;
      setTimeout(endGame, 1400);
    }
  }
}

function missedCorrect() {
  if (state.hitDone) return;
  state.hitDone = true; state.lives--; state.streak = 0;
  document.getElementById('hitBtn').disabled = true;
  const correct = getConjugated(state.correctVerb, currentMode);
  document.getElementById('romajiHint').textContent = correct.hi;
  setFeedback(`‚è∞ Lemaradt! Helyes: ${correct.jp}Ôºà${correct.hi}Ôºâ`, 'missed');
  updateHUD();
  if (state.lives <= 0) setTimeout(endGame, 1600);
  else setTimeout(nextQuestion, 2100);
}

function setFeedback(msg, cls) {
  const el = document.getElementById('feedback');
  el.textContent = msg; el.className = 'feedback ' + cls;
}

function updateHUD() {
  document.getElementById('score').textContent  = state.score;
  document.getElementById('streak').textContent = state.streak;
  document.getElementById('lives').textContent  = '‚ù§Ô∏è'.repeat(state.lives) + 'üñ§'.repeat(3-state.lives);
}

function endGame() {
  clearTimers();
  document.getElementById('gameoverOverlay').style.display = 'flex';
  const won = state.lives > 0 && state.qnum >= TOTAL_Q;
  document.getElementById('goTitle').textContent = won ? 'üéâ Gratul√°lok!' : 'üíÄ J√°t√©k v√©ge!';
  document.getElementById('goScore').textContent = state.score + ' pont';
  document.getElementById('goMsg').textContent   = won
    ? `V√©gigj√°tszottad mind a ${TOTAL_Q} k√©rd√©st! Igazi jap√°n mester vagy! üáØüáµ`
    : `Elfogytak az √©letpontjaid a ${state.qnum}. k√©rd√©sn√©l. Pr√≥b√°ld √∫jra!`;
}
</script>
</body>
</html>
